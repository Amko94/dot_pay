{
  "$id": "https://dotpay.dev/schema/pay-v0.1.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": ".pay v0.1 (Draft)",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "header",
    "payload"
  ],
  "properties": {
    "header": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "v",
        "typ",
        "alg"
      ],
      "properties": {
        "v": {
          "type": "integer",
          "const": 1
        },
        "typ": {
          "type": "string",
          "const": "pay+json"
        },
        "alg": {
          "type": "string",
          "enum": [
            "none",
            "Ed25519",
            "ES256"
          ]
        },
        "kid": {
          "type": "string",
          "minLength": 1
        }
      }
    },
    "payload": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "jti",
        "amount",
        "asset",
        "network",
        "createdAt"
      ],
      "properties": {
        "jti": {
          "type": "string",
          "description": "Unique ID (128-bit hex, 32 lowercase characters).",
          "pattern": "^[0-9a-f]{32}$"
        },
        "amount": {
          "type": "string",
          "description": "Decimal string, dot as separator, no +/- sign.",
          "pattern": "^[0-9]+(\\.[0-9]+)?$"
        },
        "asset": {
          "type": "string",
          "description": "Asset code, 2–10 characters, uppercase letters/numbers.",
          "pattern": "^[A-Z0-9]{2,10}$"
        },
        "network": {
          "type": "string",
          "description": "Network identifier, e.g. BTC-mainnet, ETH-sepolia.",
          "pattern": "^[A-Za-z0-9-]{2,64}$"
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "ISO-8601 timestamp of creation (UTC recommended)."
        },
        "exp": {
          "type": "string",
          "format": "date-time",
          "description": "Optional expiry timestamp (if present, must not be in the past)."
        },
        "note": {
          "type": "string",
          "description": "Optional free text (no personal data).",
          "maxLength": 2048
        },
        "pinHash": {
          "type": "string",
          "description": "Optional SHA-256 hash of a PIN/passphrase (hex).",
          "pattern": "^[0-9a-f]{64}$"
        }
      }
    },
    "signature": {
      "oneOf": [
        {
          "type": "null"
        },
        {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "sig"
          ],
          "properties": {
            "sig": {
              "type": "string",
              "description": "Base64URL encoded signature (no padding).",
              "pattern": "^[A-Za-z0-9_-]+$"
            }
          }
        }
      ],
      "description": "Present only if alg ≠ \"none\". Omitted in MVP (alg=\"none\")."
    }
  },
  "allOf": [
    {
      "if": {
        "properties": {
          "header": {
            "properties": {
              "alg": {
                "const": "none"
              }
            }
          }
        }
      },
      "then": {
        "not": {
          "required": [
            "signature"
          ]
        }
      }
    },
    {
      "if": {
        "properties": {
          "header": {
            "properties": {
              "alg": {
                "enum": [
                  "Ed25519",
                  "ES256"
                ]
              }
            }
          }
        }
      },
      "then": {
        "required": [
          "signature"
        ],
        "properties": {
          "signature": {
            "type": "object"
          }
        }
      }
    }
  ]
}
